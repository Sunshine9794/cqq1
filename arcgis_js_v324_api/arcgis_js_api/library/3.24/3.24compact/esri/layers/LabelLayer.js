// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.24/esri/copyright.txt for details.
//>>built
require({cache:{"esri/PopupInfo":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/i18n dojo/has dojo/Deferred dojo/sniff dojo/promise/all dojox/html/entities ./lang ./kernel ./request ./promiseList ./tasks/query ./tasks/QueryTask ./tasks/RelationshipQuery ./tasks/StatisticDefinition ./support/expressionUtils ./layers/support/attributeUtils dojo/i18n!dojo/cldr/nls/number".split(" "),function(k,n,t,w,B,q,m,b,a,d,h,g,e,f,c,u,v,r,l,y,z){k=k(null,{declaredClass:"esri.PopupInfo",
_reExprField:/^\s*expression\//i,_exprPrefix:"expression/",_relatedFieldPrefix:"relationships/",initialize:function(a,c){if(a){n.mixin(this,c);this.info=a;this.title=this.getTitle;this.content=this.getContent;this._exprCache=this._compileExpressions(this.info.expressionInfos);var p=this._fieldLabels={},b=this._fieldsMap={};this.info.fieldInfos&&t.forEach(this.info.fieldInfos,function(a){var c=a.fieldName.toLowerCase(),x=this._isExpressionField(c)?this.getExpressionInfo(c):null;p[c]=x?x.title:a.label;
b[c]=a},this);this.titleHasRelatedFields=!(!this.info.title||-1===this.info.title.indexOf("{"+this._relatedFieldPrefix))}},toJson:function(){return w.fromJson(w.toJson(this.info))},getTitle:function(){},getContent:function(){},getFieldInfo:function(a){var c;t.some(this.info&&this.info.fieldInfos,function(p){p.fieldName===a&&(c=p);return!!c});return c},getExpressionInfo:function(a){if(this._isExpressionField(a)){a=a.replace(this._reExprField,"");a=a.toLowerCase();var c;t.some(this.info.expressionInfos,
function(b){b.name.toLowerCase()===a&&(c=b);return!!c});return c}},hasGeometryOperations:function(){return t.some(this.info.expressionInfos,function(a){return l.hasGeometryOperations(a.expression)})},getComponents:function(a){var c=this.info,b={};c.fieldInfos&&(c=t.filter(c.fieldInfos,function(a){return-1!==a.fieldName.indexOf(this._relatedFieldPrefix)},this))&&0<c.length&&(b.relatedInfo=this._getRelatedRecords({graphic:a,fieldsInfo:c}));this._needFullResolutionFeature(a)&&(b.fullResolutionFeature=
this._getFullResolutionFeature(a));return f(b).then(n.hitch(this,function(c){return this._getPopupValues(a,c.fullResolutionFeature)}))},getAttachments:function(a){var c=a.getSourceLayer();a=a.attributes;if(this.info.showAttachments&&c&&c.hasAttachments&&c.objectIdField&&(a=a&&a[c.objectIdField]))return c.queryAttachmentInfos(a)},_needFullResolutionFeature:function(a){return(a=a.getSourceLayer())?"esriGeometryPoint"!==a.geometryType&&"function"===typeof a.getMaxAllowableOffset&&0<a.getMaxAllowableOffset()&&
this.hasGeometryOperations():!1},_getFullResolutionFeature:function(a){var b=a.getSourceLayer(),d=b.objectIdField;a=(a=a.attributes)&&d&&a[d];if(null==a)return null;var e=new c;e.objectIds=[a];e.maxAllowableOffset=0;e.outFields=[d];return b.queryFeatures(e).then(function(a){return a.features&&a.features[0]})},_isExpressionField:function(a){return this._reExprField.test(a)},_compileExpressions:function(a){var c={};t.forEach(a,function(a){var b=a.returnType&&a.returnType.toLowerCase();c[a.name]=y.createAttributeCache({valueExpression:a.expression},
"number"!==b)});return c},_fetchAttributes:function(a,c){var b=n.clone(a.attributes)||{},e=c&&c.geometry,f=this._exprPrefix,p=this._exprCache;t.forEach(this.info.expressionInfos,function(c){var x=f+c.name;c=(c=p[c.name])?a._getDataValue(c.attributeInfo,c,l,null,e):null;"string"===typeof c&&(c=d.encode(c));b[x]=c});return b},_getPopupValues:function(a,c,b){var d=this.info,e=a.getSourceLayer(),f=this._fetchAttributes(a,c),x=n.clone(f);c=d.fieldInfos;var p="",g="",u,l,r,E,D,v=e&&e._getDateOpts&&e._getDateOpts().properties,
v=v&&v.slice(0),m={dateFormat:{properties:v,formatter:"DateFormat"+this._insertOffset(this._dateFormats.shortDateShortTime)}};if(this._relatedInfo)for(E in this._relatedInfo)if(this._relatedInfo.hasOwnProperty(E)){var y=this._relatedInfo[E],z=this._relatedLayersInfo[E];y&&(t.forEach(y.relatedFeatures,function(a){for(D in a.attributes)if(a.attributes.hasOwnProperty(D)&&"esriRelCardinalityOneToOne"===z.relation.cardinality){var c=this._toRelatedFieldName([z.relation.id,D]);f[c]=x[c]=a.attributes[D]}},
this),t.forEach(y.relatedStatsFeatures,function(a){for(D in a.attributes)if(a.attributes.hasOwnProperty(D)){var c=this._toRelatedFieldName([z.relation.id,D]);f[c]=x[c]=a.attributes[D]}},this))}c&&t.forEach(c,function(a){l=a.fieldName;var c=this._getLayerFieldInfo(e,l);c&&(l=a.fieldName=c.name);x[l]=this._formatValue(x[l],l,m);v&&a.format&&a.format.dateFormat&&(a=t.indexOf(v,l),-1<a&&v.splice(a,1))},this);if(e){E=e.types;var q=(y=e.typeIdField)&&f[y];for(l in f)if(f.hasOwnProperty(l)&&-1===l.indexOf(this._relatedFieldPrefix)&&
(r=f[l],h.isDefined(r))){var B=this._getDomainName(e,a,E,q,l,r);h.isDefined(B)?x[l]=B:l===y&&(B=this._getTypeName(e,a,r),h.isDefined(B)&&(x[l]=B))}}d.title&&(p=this._processFieldsInLinks(this._fixTokens(d.title,e),f),p=n.trim(h.substitute(x,p,m)||""));if(b)return{title:p};d.description&&(g=this._processFieldsInLinks(this._fixTokens(d.description,e),f),g=n.trim(h.substitute(x,g,m)||""));c&&(u=[],t.forEach(c,function(a){(l=a.fieldName)&&a.visible&&u.push([this._fieldLabels[l.toLowerCase()]||l,h.substitute(x,
"${"+l+"}",m)||""])},this));var k,w;d.mediaInfos&&(k=[],t.forEach(d.mediaInfos,function(a){w=0;r=a.value;switch(a.type){case "image":var c=r.sourceURL,c=c&&n.trim(h.substitute(f,this._fixTokens(c,e)));w=!!c;break;case "piechart":case "linechart":case "columnchart":case "barchart":var b,c=r.normalizeField;r.fields=t.map(r.fields,function(a){return(b=this._getLayerFieldInfo(e,a))?b.name:a},this);c&&(b=this._getLayerFieldInfo(e,c),r.normalizeField=b?b.name:c);w=t.some(r.fields,function(a){return h.isDefined(f[a])||
-1!==a.indexOf(this._relatedFieldPrefix)&&this._relatedInfo},this);break;default:return}if(w){a=n.clone(a);r=a.value;var c=a.title?this._processFieldsInLinks(this._fixTokens(a.title,e),f):"",d=a.caption?this._processFieldsInLinks(this._fixTokens(a.caption,e),f):"";a.title=c?n.trim(h.substitute(x,c,m)||""):"";a.caption=d?n.trim(h.substitute(x,d,m)||""):"";if("image"===a.type)r.sourceURL=h.substitute(f,this._fixTokens(r.sourceURL,e)),r.linkURL&&(r.linkURL=n.trim(h.substitute(f,this._fixTokens(r.linkURL,
e))||""));else{var p,g;t.forEach(r.fields,function(a,c){if(-1!==a.indexOf(this._relatedFieldPrefix))g=this._getRelatedChartInfos(a,r,f,m),g instanceof Array?r.fields=g:r.fields[c]=g;else{var b=f[a],b=void 0===b?null:b;p=f[r.normalizeField]||0;b&&p&&(b/=p);r.fields[c]={y:b,tooltip:(this._fieldLabels[a.toLowerCase()]||a)+":\x3cbr/\x3e"+this._formatValue(b,a,m,!!p)}}},this)}k.push(a)}},this));return{title:p,description:g,hasDescription:!!d.description,fields:u&&u.length?u:null,mediaInfos:k&&k.length?
k:null,formatted:x,editSummary:e&&e.getEditSummary?e.getEditSummary(a):""}},_getRelatedChartInfos:function(a,c,b,e){var d,f,x,p,g,u;d=[];u=this._fromRelatedFieldName(a);g=u[0];f=this._relatedInfo[g];g=this._relatedLayersInfo[g];f&&t.forEach(f.relatedFeatures,function(f){f=f.attributes;var g,l;for(l in f)if(f.hasOwnProperty(l)&&l===u[1]){g={};p=f[l];c.normalizeField&&(x=-1!==c.normalizeField.indexOf(this._relatedFieldPrefix)?f[this._fromRelatedFieldName(c.normalizeField)[1]]:b[c.normalizeField]);p&&
x&&(p/=x);if(c.tooltipField)if(-1!==c.tooltipField.indexOf(this._relatedFieldPrefix)){var r=this._fromRelatedFieldName(c.tooltipField)[1],E=h.isDefined(f[r])?this._formatValue(f[r],c.tooltipField,e,!!x):r;g.tooltip=E+":\x3cbr/\x3e"+this._formatValue(p,r,e,!!x)}else g.tooltip=(this._fieldLabels[a.toLowerCase()]||a)+":\x3cbr/\x3e"+this._formatValue(p,c.tooltipField,e,!!x);else g.tooltip=p;g.y=p;d.push(g)}},this);return"esriRelCardinalityOneToMany"===g.relation.cardinality||"esriRelCardinalityManyToMany"===
g.relation.cardinality?d:d[0]},_dateFormats:{shortDate:"(datePattern: 'M/d/y', selector: 'date')",shortDateLE:"(datePattern: 'd/M/y', selector: 'date')",longMonthDayYear:"(datePattern: 'MMMM d, y', selector: 'date')",dayShortMonthYear:"(datePattern: 'd MMM y', selector: 'date')",longDate:"(datePattern: 'EEEE, MMMM d, y', selector: 'date')",shortDateShortTime:"(datePattern: 'M/d/y', timePattern: 'h:mm a', selector: 'date and time')",shortDateLEShortTime:"(datePattern: 'd/M/y', timePattern: 'h:mm a', selector: 'date and time')",
shortDateShortTime24:"(datePattern: 'M/d/y', timePattern: 'H:mm', selector: 'date and time')",shortDateLEShortTime24:"(datePattern: 'd/M/y', timePattern: 'H:mm', selector: 'date and time')",shortDateLongTime:"(datePattern: 'M/d/y', timePattern: 'h:mm:ss a', selector: 'date and time')",shortDateLELongTime:"(datePattern: 'd/M/y', timePattern: 'h:mm:ss a', selector: 'date and time')",shortDateLongTime24:"(datePattern: 'M/d/y', timePattern: 'H:mm:ss', selector: 'date and time')",shortDateLELongTime24:"(datePattern: 'd/M/y', timePattern: 'H:mm:ss', selector: 'date and time')",
longMonthYear:"(datePattern: 'MMMM y', selector: 'date')",shortMonthYear:"(datePattern: 'MMM y', selector: 'date')",year:"(datePattern: 'y', selector: 'date')"},_reHref:/href\s*=\s*\"([^\"]+)\"/ig,_reHrefApos:/href\s*=\s*\'([^\']+)\'/ig,_reEmptyHref:/^href\s*=\s*"\s*"$/i,_reEmptyHrefApos:/^href\s*=\s*'\s*'$/i,_fixTokens:function(a,c){var b=this;return a.replace(/(\{([^\{\r\n]+)\})/g,function(a,e,d){a=b._getLayerFieldInfo(c,d);return"$"+(a?"{"+a.name+"}":e)})},_encodeAttributes:function(a){a=n.clone(a)||
{};var c,b;for(c in a)(b=a[c])&&"string"===typeof b&&(b=encodeURIComponent(b).replace(/\'/g,"\x26apos;"),a[c]=b);return a},_processFieldsInLinks:function(a,c){var b=this._encodeAttributes(c),b=n.hitch(this,this._addValuesToHref,c,b);a&&(a=a.replace(this._reHref,b).replace(this._reHrefApos,b));return a},_addValuesToHref:function(a,c,b,e){e=e&&n.trim(e);b=h.substitute(e&&0===e.indexOf("${")?a:c,b);this._reEmptyHref.test(b)?b='href\x3d"about:blank"':this._reEmptyHrefApos.test(b)&&(b="href\x3d'about:blank'");
return b},_getLayerFieldInfo:function(a,c){return a&&a.getField?a.getField(c):null},_formatValue:function(a,c,b,e){var d=this._fieldsMap[c.toLowerCase()],f=d&&d.format;c=-1!==t.indexOf(b.dateFormat.properties,c);var x="number"===typeof a&&!c&&(!f||!f.dateFormat);if(!h.isDefined(a)||!d||!h.isDefined(f))return x?this._forceLTR(a):a;var g="",d=[],p=f.hasOwnProperty("places")||f.hasOwnProperty("digitSeparator"),u=f.hasOwnProperty("digitSeparator")?f.digitSeparator:!0;if(p&&!c)g="NumberFormat",d.push("places: "+
(h.isDefined(f.places)&&(!e||0<f.places)?Number(f.places):"Infinity")),d.length&&(g+="("+d.join(",")+")");else if(f.dateFormat)g="DateFormat"+this._insertOffset(this._dateFormats[f.dateFormat]||this._dateFormats.shortDateShortTime);else return x?this._forceLTR(a):a;var l=this._applyFormatting(a,g,b);p&&-1<a.constructor.toString().indexOf("Array")&&(l="",t.forEach(a,n.hitch(this,function(a,c){c&&(l+=" ");l+=this._applyFormatting(a,g,b)})));p&&!u&&z.group&&(l=l.replace(new RegExp("\\"+z.group,"g"),
""));c&&(l='\x3cspan class\x3d"esriDateValue"\x3e'+l+"\x3c/span\x3e");return x?this._forceLTR(l):l},_applyFormatting:function(a,c,b){return h.substitute({myKey:a},"${myKey:"+c+"}",b)||""},_forceLTR:function(a){var c=b("ie");return c&&10>=c?a:"\x3cspan class\x3d'esriNumericValue'\x3e"+a+"\x3c/span\x3e"},_insertOffset:function(a){a&&(a=h.isDefined(this.utcOffset)?a.replace(/\)\s*$/,", utcOffset:"+this.utcOffset+")"):a);return a},_getDomainName:function(a,c,b,e,f,d){return(a=a.getDomain&&a.getDomain(f,
{feature:c}))&&a.codedValues?a.getName(d):null},_getTypeName:function(a,c,b){return(a=a.getType&&a.getType(c))&&a.name},_getRelatedRecords:function(a){var c=a.graphic,b;this._relatedLayersInfoPromise||(this._relatedLayersInfoPromise=this._getRelatedLayersInfo(a).then(n.hitch(this,function(a){for(b in a)a.hasOwnProperty(b)&&a[b]&&(this._relatedLayersInfo[b].relatedLayerInfo=a[b])})));return this._relatedLayersInfoPromise.then(n.hitch(this,function(){return this._queryRelatedLayers(c)})).then(n.hitch(this,
function(a){this._setRelatedRecords(c,a);return a}))},_getRelatedLayersInfo:function(c){var b=c.fieldsInfo,f,d,g={};f=c.graphic.getSourceLayer();this._relatedLayersInfo||(this._relatedLayersInfo={});t.forEach(b,function(a){var c,b,d,e;c=this._fromRelatedFieldName(a.fieldName);b=c[0];c=c[1];b&&(!this._relatedLayersInfo[b]&&f&&f.relationships&&(t.some(f.relationships,function(a){if(a.id==b)return e=a,!0}),e&&(this._relatedLayersInfo[b]={relation:e,relatedFields:[],outStatistics:[]})),this._relatedLayersInfo[b]&&
(this._relatedLayersInfo[b].relatedFields.push(c),a.statisticType&&(d=new r,d.statisticType=a.statisticType,d.onStatisticField=c,d.outStatisticFieldName=c,this._relatedLayersInfo[b].outStatistics.push(d))))},this);for(d in this._relatedLayersInfo)this._relatedLayersInfo.hasOwnProperty(d)&&this._relatedLayersInfo[d]&&(c=this._relatedLayersInfo[d].relation,c=f.url.replace(/[0-9]+$/,c.relatedTableId),this._relatedLayersInfo[d].relatedLayerUrl=c,g[d]=e({url:c,content:{f:"json"},callbackParamName:"callback"}));
return a(g)},_queryRelatedLayers:function(c){var b={},d;for(d in this._relatedLayersInfo)this._relatedLayersInfo.hasOwnProperty(d)&&(b[d]=this._queryRelatedLayer({graphic:c,relatedInfo:this._relatedLayersInfo[d]}));return a(b)},_queryRelatedLayer:function(b){var d,f,e,g,h,x,l,r,p,v,y,z,q;d=b.graphic;f=d.getSourceLayer();e=f.url.match(/[0-9]+$/g)[0];y=b.relatedInfo;v=y.relatedLayerInfo;z=y.relatedLayerUrl;b=y.relation;t.some(v.relationships,function(a){if(a.relatedTableId===parseInt(e,10))return g=
a,!0},this);g&&(h=new c,t.some(v.fields,function(a){if(a.name===g.keyField)return r=-1!==t.indexOf(["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble"],a.type)?"number":"string",!0}),g.relationshipTableId&&g.keyFieldInRelationshipTable?(q=new m,this._queryRelatedRecords(d,g).then(n.hitch(this,function(a){var b;(b=a[d.attributes[f.objectIdField]])?(a=t.map(b.features,function(a){return a.attributes[v.objectIdField]},this),y.outStatistics&&0<y.outStatistics.length&&
v.supportsStatistics&&(p=new c,p.objectIds=a,p.outFields=h.outFields,p.outStatistics=y.outStatistics),p&&(x=new u(z),x.execute(p).then(n.hitch(this,function(a){var c=[];c.push(b);c.push(a);q.resolve(c)})))):q.resolve()}))):(l="string"===r?g.keyField+"\x3d'"+d.attributes[b.keyField]+"'":g.keyField+"\x3d"+d.attributes[b.keyField],h.where=l,h.outFields=y.relatedFields,y.outStatistics&&0<y.outStatistics.length&&v.supportsStatistics&&(p=new c,p.where=h.where,p.outFields=h.outFields,p.outStatistics=y.outStatistics),
x=new u(z),l=[],l.push(x.execute(h)),p&&l.push(x.execute(p))));return l?a(l):q?q.promise:void 0},_setRelatedRecords:function(a,c){this._relatedInfo=[];for(var b in c)if(c.hasOwnProperty(b)&&c[b]){var d=c[b];this._relatedInfo[b]={};this._relatedInfo[b].relatedFeatures=d[0].features;h.isDefined(d[1])&&(this._relatedInfo[b].relatedStatsFeatures=d[1].features)}},_handlerErrorResponse:function(a,c){a.reject(c)},_fromRelatedFieldName:function(a){var c=[];-1!==a.indexOf(this._relatedFieldPrefix)&&(a=a.split("/"),
c=a.slice(1));return c},_toRelatedFieldName:function(a){var c="";a&&0<a.length&&(c=this._relatedFieldPrefix+a[0]+"/"+a[1]);return c},_queryRelatedRecords:function(a,c){var b=a.getSourceLayer(),d=new v;d.outFields=["*"];d.relationshipId=c.id;d.objectIds=[a.attributes[b.objectIdField]];return b.queryRelatedFeatures(d)}});q("extend-esri")&&(g.PopupInfo=g.PopupInfoTemplate=k);return k})},"dojox/html/entities":function(){define(["dojo/_base/lang"],function(k){var n=k.getObject("dojox.html.entities",!0),
t=function(n,q){var m,b;if(q._encCache&&q._encCache.regexp&&q._encCache.mapper&&q.length==q._encCache.length)m=q._encCache.mapper,b=q._encCache.regexp;else{m={};b=["["];var a;for(a=0;a<q.length;a++)m[q[a][0]]="\x26"+q[a][1]+";",b.push(q[a][0]);b.push("]");b=new RegExp(b.join(""),"g");q._encCache={mapper:m,regexp:b,length:q.length}}return n=n.replace(b,function(a){return m[a]})},w=function(n,q){var m,b;if(q._decCache&&q._decCache.regexp&&q._decCache.mapper&&q.length==q._decCache.length)m=q._decCache.mapper,
b=q._decCache.regexp;else{m={};b=["("];var a;for(a=0;a<q.length;a++){var d="\x26"+q[a][1]+";";a&&b.push("|");m[d]=q[a][0];b.push(d)}b.push(")");b=new RegExp(b.join(""),"g");q._decCache={mapper:m,regexp:b,length:q.length}}return n=n.replace(b,function(a){return m[a]})};n.html=[["\x26","amp"],['"',"quot"],["\x3c","lt"],["\x3e","gt"],["\u00a0","nbsp"]];n.latin=[["\u00a1","iexcl"],["\u00a2","cent"],["\u00a3","pound"],["\u20ac","euro"],["\u00a4","curren"],["\u00a5","yen"],["\u00a6","brvbar"],["\u00a7",
"sect"],["\u00a8","uml"],["\u00a9","copy"],["\u00aa","ordf"],["\u00ab","laquo"],["\u00ac","not"],["\u00ad","shy"],["\u00ae","reg"],["\u00af","macr"],["\u00b0","deg"],["\u00b1","plusmn"],["\u00b2","sup2"],["\u00b3","sup3"],["\u00b4","acute"],["\u00b5","micro"],["\u00b6","para"],["\u00b7","middot"],["\u00b8","cedil"],["\u00b9","sup1"],["\u00ba","ordm"],["\u00bb","raquo"],["\u00bc","frac14"],["\u00bd","frac12"],["\u00be","frac34"],["\u00bf","iquest"],["\u00c0","Agrave"],["\u00c1","Aacute"],["\u00c2",
"Acirc"],["\u00c3","Atilde"],["\u00c4","Auml"],["\u00c5","Aring"],["\u00c6","AElig"],["\u00c7","Ccedil"],["\u00c8","Egrave"],["\u00c9","Eacute"],["\u00ca","Ecirc"],["\u00cb","Euml"],["\u00cc","Igrave"],["\u00cd","Iacute"],["\u00ce","Icirc"],["\u00cf","Iuml"],["\u00d0","ETH"],["\u00d1","Ntilde"],["\u00d2","Ograve"],["\u00d3","Oacute"],["\u00d4","Ocirc"],["\u00d5","Otilde"],["\u00d6","Ouml"],["\u00d7","times"],["\u00d8","Oslash"],["\u00d9","Ugrave"],["\u00da","Uacute"],["\u00db","Ucirc"],["\u00dc",
"Uuml"],["\u00dd","Yacute"],["\u00de","THORN"],["\u00df","szlig"],["\u00e0","agrave"],["\u00e1","aacute"],["\u00e2","acirc"],["\u00e3","atilde"],["\u00e4","auml"],["\u00e5","aring"],["\u00e6","aelig"],["\u00e7","ccedil"],["\u00e8","egrave"],["\u00e9","eacute"],["\u00ea","ecirc"],["\u00eb","euml"],["\u00ec","igrave"],["\u00ed","iacute"],["\u00ee","icirc"],["\u00ef","iuml"],["\u00f0","eth"],["\u00f1","ntilde"],["\u00f2","ograve"],["\u00f3","oacute"],["\u00f4","ocirc"],["\u00f5","otilde"],["\u00f6",
"ouml"],["\u00f7","divide"],["\u00f8","oslash"],["\u00f9","ugrave"],["\u00fa","uacute"],["\u00fb","ucirc"],["\u00fc","uuml"],["\u00fd","yacute"],["\u00fe","thorn"],["\u00ff","yuml"],["\u0192","fnof"],["\u0391","Alpha"],["\u0392","Beta"],["\u0393","Gamma"],["\u0394","Delta"],["\u0395","Epsilon"],["\u0396","Zeta"],["\u0397","Eta"],["\u0398","Theta"],["\u0399","Iota"],["\u039a","Kappa"],["\u039b","Lambda"],["\u039c","Mu"],["\u039d","Nu"],["\u039e","Xi"],["\u039f","Omicron"],["\u03a0","Pi"],["\u03a1",
"Rho"],["\u03a3","Sigma"],["\u03a4","Tau"],["\u03a5","Upsilon"],["\u03a6","Phi"],["\u03a7","Chi"],["\u03a8","Psi"],["\u03a9","Omega"],["\u03b1","alpha"],["\u03b2","beta"],["\u03b3","gamma"],["\u03b4","delta"],["\u03b5","epsilon"],["\u03b6","zeta"],["\u03b7","eta"],["\u03b8","theta"],["\u03b9","iota"],["\u03ba","kappa"],["\u03bb","lambda"],["\u03bc","mu"],["\u03bd","nu"],["\u03be","xi"],["\u03bf","omicron"],["\u03c0","pi"],["\u03c1","rho"],["\u03c2","sigmaf"],["\u03c3","sigma"],["\u03c4","tau"],["\u03c5",
"upsilon"],["\u03c6","phi"],["\u03c7","chi"],["\u03c8","psi"],["\u03c9","omega"],["\u03d1","thetasym"],["\u03d2","upsih"],["\u03d6","piv"],["\u2022","bull"],["\u2026","hellip"],["\u2032","prime"],["\u2033","Prime"],["\u203e","oline"],["\u2044","frasl"],["\u2118","weierp"],["\u2111","image"],["\u211c","real"],["\u2122","trade"],["\u2135","alefsym"],["\u2190","larr"],["\u2191","uarr"],["\u2192","rarr"],["\u2193","darr"],["\u2194","harr"],["\u21b5","crarr"],["\u21d0","lArr"],["\u21d1","uArr"],["\u21d2",
"rArr"],["\u21d3","dArr"],["\u21d4","hArr"],["\u2200","forall"],["\u2202","part"],["\u2203","exist"],["\u2205","empty"],["\u2207","nabla"],["\u2208","isin"],["\u2209","notin"],["\u220b","ni"],["\u220f","prod"],["\u2211","sum"],["\u2212","minus"],["\u2217","lowast"],["\u221a","radic"],["\u221d","prop"],["\u221e","infin"],["\u2220","ang"],["\u2227","and"],["\u2228","or"],["\u2229","cap"],["\u222a","cup"],["\u222b","int"],["\u2234","there4"],["\u223c","sim"],["\u2245","cong"],["\u2248","asymp"],["\u2260",
"ne"],["\u2261","equiv"],["\u2264","le"],["\u2265","ge"],["\u2282","sub"],["\u2283","sup"],["\u2284","nsub"],["\u2286","sube"],["\u2287","supe"],["\u2295","oplus"],["\u2297","otimes"],["\u22a5","perp"],["\u22c5","sdot"],["\u2308","lceil"],["\u2309","rceil"],["\u230a","lfloor"],["\u230b","rfloor"],["\u2329","lang"],["\u232a","rang"],["\u25ca","loz"],["\u2660","spades"],["\u2663","clubs"],["\u2665","hearts"],["\u2666","diams"],["\u0152","OElig"],["\u0153","oelig"],["\u0160","Scaron"],["\u0161","scaron"],
["\u0178","Yuml"],["\u02c6","circ"],["\u02dc","tilde"],["\u2002","ensp"],["\u2003","emsp"],["\u2009","thinsp"],["\u200c","zwnj"],["\u200d","zwj"],["\u200e","lrm"],["\u200f","rlm"],["\u2013","ndash"],["\u2014","mdash"],["\u2018","lsquo"],["\u2019","rsquo"],["\u201a","sbquo"],["\u201c","ldquo"],["\u201d","rdquo"],["\u201e","bdquo"],["\u2020","dagger"],["\u2021","Dagger"],["\u2030","permil"],["\u2039","lsaquo"],["\u203a","rsaquo"]];n.encode=function(k,q){k&&(q?k=t(k,q):(k=t(k,n.html),k=t(k,n.latin)));
return k};n.decode=function(k,q){k&&(q?k=w(k,q):(k=w(k,n.html),k=w(k,n.latin)));return k};return n})},"esri/promiseList":function(){define(["dojo/_base/array","dojo/Deferred","dojo/when"],function(k,n,t){var w=k.forEach;return function(k){function q(b,c){a[c]=b;g.progress([b,c]);0===--e&&g.resolve(a)}var m,b;k instanceof Array?b=k:k&&"object"===typeof k&&(m=k);var a,d=[];if(m){b=[];for(var h in m)Object.hasOwnProperty.call(m,h)&&(d.push(h),b.push(m[h]));a={}}else b&&(a=[]);if(!b||!b.length)return(new n).resolve(a);
var g=new n;g.promise.always(function(){a=d=null});var e=b.length;w(b,function(a,c){m||d.push(c);t(a,function(a){g.isFulfilled()||q(a,d[c])},function(a){g.isFulfilled()||q(a,d[c])})});return g.promise}})},"esri/tasks/QueryTask":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/Deferred dojo/_base/json dojo/has ../kernel ../request ../deferredUtils ../geometry/Extent ../geometry/normalizeUtils ./Task ./FeatureSet".split(" "),function(k,n,t,w,B,q,m,b,a,d,h,g,e){var f=
k(null,{url:null,query:null,requestOptions:null,pagination:null,pageSize:null,_fetchDfd:null,_startPage:null,_result:null,constructor:function(a){this._handleSuccess=n.hitch(this,this._handleSuccess);this._handleError=n.hitch(this,this._handleError);n.mixin(this,a);null==this.pagination&&(this.pagination=!1);null==this.pageSize&&(this.pageSize=1E3)},execute:function(){var a=new w(this._canceler);this._fetchDfd=a;this._result=null;this._sendRequest();return a.promise},_canceler:function(a){var c=a._pendingRequest,
b;a.isFulfilled()||!c||c.isFulfilled()||(c.cancel(),b=c.results&&c.results[1]);a._pendingRequest=null;return b},_sendRequest:function(a){var c=this.query;this.pagination&&(this._startPage=c.resultOffset=null==a?0:a,c.resultRecordCount=this.pageSize);this._fetchDfd._pendingRequest=b({url:this.url,content:c,callbackParamName:"callback"},this.requestOptions);this._fetchDfd._pendingRequest.then(this._handleSuccess).otherwise(this._handleError)},_handleSuccess:function(a){this.pagination?(a.exceededTransferLimit&&
this._sendRequest(this._startPage+this.pageSize),this._result?this._result.features=this._result.features.concat(a.features):this._result=a,this._fetchDfd.progress(a),a.exceededTransferLimit||this._fetchDfd.resolve(this._result)):(this._fetchDfd.progress(a),this._fetchDfd.resolve(a))},_handleError:function(a){this._fetchDfd.reject(a)}});k=k(g,{declaredClass:"esri.tasks.QueryTask",_eventMap:{complete:["featureSet"],"execute-for-count-complete":["count"],"execute-for-ids-complete":["objectIds"],"execute-relationship-query-complete":["featureSets"]},
constructor:function(a,b){this._handler=n.hitch(this,this._handler);this._relationshipQueryHandler=n.hitch(this,this._relationshipQueryHandler);this._executeForIdsHandler=n.hitch(this,this._executeForIdsHandler);this._countHandler=n.hitch(this,this._countHandler);this._extentHandler=n.hitch(this,this._extentHandler);this.source=b&&b.source;this.gdbVersion=b&&b.gdbVersion;this.registerConnectEvents()},__msigns:[{n:"execute",c:4,a:[{i:0,p:["geometry"]}],e:2},{n:"rawExecute",c:2,a:[{i:0,p:["geometry"]}],
e:2},{n:"executeForIds",c:3,a:[{i:0,p:["geometry"]}],e:2},{n:"executeForCount",c:3,a:[{i:0,p:["geometry"]}],e:2},{n:"executeForExtent",c:3,a:[{i:0,p:["geometry"]}],e:2}],onComplete:function(){},onRawExecuteComplete:function(){},onExecuteRelationshipQueryComplete:function(){},onExecuteForIdsComplete:function(){},onExecuteForCountComplete:function(){},onExecuteForExtentComplete:function(){},execute:function(a,d,e,f,g){f=g.assembly;a=this._encode(n.mixin({},this._url.query,{f:"json"},a.toJson(f&&f[0])));
var c=this._handler,h=this._errorHandler;this.source&&(f={source:this.source.toJson()},a.layer=B.toJson(f));this.gdbVersion&&(a.gdbVersion=this.gdbVersion);return b({url:this._url.path+"/query",content:a,callbackParamName:"callback",load:function(a,b){c(a,b,d,e,g.dfd)},error:function(a){h(a,e,g.dfd)}},this.requestOptions)},rawExecute:function(a,b,d){b=b||{};a=this._encode(n.mixin({},this._url.query,{f:"json"},a.toJson(d.assembly&&d.assembly[0])));this.source&&(a.layer=B.toJson({source:this.source.toJson()}));
this.gdbVersion&&(a.gdbVersion=this.gdbVersion);return(new f({url:this._url.path+"/query",query:a,requestOptions:this.requestOptions,pagination:b.pagination,pageSize:b.pageSize})).execute().then(null,null,function(a){d.dfd.progress(a)}).then(n.hitch(this,function(a){this._successHandler([a],"onRawExecuteComplete",null,d.dfd)})).otherwise(n.hitch(this,function(a){this._errorHandler(a,null,d.dfd)}))},executeRelationshipQuery:function(c,d,f){c=this._encode(n.mixin({},this._url.query,{f:"json"},c.toJson()));
var e=this._relationshipQueryHandler,g=this._errorHandler;this.gdbVersion&&(c.gdbVersion=this.gdbVersion);var h=new w(a._dfdCanceller);h._pendingDfd=b({url:this._url.path+"/queryRelatedRecords",content:c,callbackParamName:"callback",load:function(a,c){e(a,c,d,f,h)},error:function(a){g(a,f,h)}},this.requestOptions);return h},executeForIds:function(a,d,f,e){var c=e.assembly;a=this._encode(n.mixin({},this._url.query,{f:"json",returnIdsOnly:!0},a.toJson(c&&c[0])));var g=this._executeForIdsHandler,h=this._errorHandler;
this.source&&(c={source:this.source.toJson()},a.layer=B.toJson(c));this.gdbVersion&&(a.gdbVersion=this.gdbVersion);return b({url:this._url.path+"/query",content:a,callbackParamName:"callback",load:function(a,c){g(a,c,d,f,e.dfd)},error:function(a){h(a,f,e.dfd)}},this.requestOptions)},executeForCount:function(a,d,f,e){var c=e.assembly;a=this._encode(n.mixin({},this._url.query,{f:"json",returnIdsOnly:!0,returnCountOnly:!0},a.toJson(c&&c[0])));var g=this._countHandler,h=this._errorHandler;this.source&&
(c={source:this.source.toJson()},a.layer=B.toJson(c));this.gdbVersion&&(a.gdbVersion=this.gdbVersion);return b({url:this._url.path+"/query",content:a,callbackParamName:"callback",load:function(a,c){g(a,c,d,f,e.dfd)},error:function(a){h(a,f,e.dfd)}},this.requestOptions)},executeForExtent:function(a,d,f,e){var c=e.assembly;a=this._encode(n.mixin({},this._url.query,{f:"json",returnExtentOnly:!0,returnCountOnly:!0},a.toJson(c&&c[0])));var g=this._extentHandler,h=this._errorHandler;this.source&&(c={source:this.source.toJson()},
a.layer=B.toJson(c));this.gdbVersion&&(a.gdbVersion=this.gdbVersion);return b({url:this._url.path+"/query",content:a,callbackParamName:"callback",load:function(a,c){g(a,c,d,f,e.dfd)},error:function(a){h(a,f,e.dfd)}},this.requestOptions)},_handler:function(a,b,d,f,g){try{var c=new e(a);this._successHandler([c],"onComplete",d,g)}catch(z){this._errorHandler(z,f,g)}},_relationshipQueryHandler:function(a,b,d,f,g){try{var c=a.geometryType,h=a.spatialReference,l={};t.forEach(a.relatedRecordGroups,function(a){var b=
{};b.geometryType=c;b.spatialReference=h;b.features=a.relatedRecords;b=new e(b);if(null!=a.objectId)l[a.objectId]=b;else for(var d in a)a.hasOwnProperty(d)&&"relatedRecords"!==d&&(l[a[d]]=b)});this._successHandler([l],"onExecuteRelationshipQueryComplete",d,g)}catch(E){this._errorHandler(E,f,g)}},_executeForIdsHandler:function(a,b,d,f,e){try{this._successHandler([a.objectIds],"onExecuteForIdsComplete",d,e)}catch(y){this._errorHandler(y,f,e)}},_countHandler:function(a,b,d,f,e){try{var c,g=a.features,
h=a.objectIds;if(h)c=h.length;else{if(g)throw Error("Unable to perform query. Please check your parameters.");c=a.count}this._successHandler([c],"onExecuteForCountComplete",d,e)}catch(E){this._errorHandler(E,f,e)}},_extentHandler:function(a,b,f,e,g){try{a.extent&&(a.extent=new d(a.extent)),this._successHandler([a],"onExecuteForExtentComplete",f,g)}catch(y){this._errorHandler(y,e,g)}}});h._createWrappers(k);q("extend-esri")&&n.setObject("tasks.QueryTask",k,m);return k})},"esri/tasks/Task":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/json dojo/has ../kernel ../deferredUtils ../urlUtils ../Evented".split(" "),
function(k,n,t,w,B,q,m,b){k=k(b,{declaredClass:"esri.tasks._Task",_eventMap:{error:["error"],complete:["result"]},constructor:function(a,b){a&&n.isString(a)&&(this._url=m.urlToObject(this.url=a));b&&b.requestOptions&&(this.requestOptions=b.requestOptions);this.normalization=!0;this._errorHandler=n.hitch(this,this._errorHandler);this.registerConnectEvents()},_useSSL:function(){var a=this._url,b=/^http:/i;this.url&&(this.url=this.url.replace(b,"https:"));a&&a.path&&(a.path=a.path.replace(b,"https:"))},
_encode:function(a,b,h){var d,e,f={},c,u;for(c in a)if("declaredClass"!==c&&(d=a[c],e=typeof d,null!==d&&void 0!==d&&"function"!==e))if(n.isArray(d))for(f[c]=[],u=d.length,e=0;e<u;e++)f[c][e]=this._encode(d[e]);else"object"===e?d.toJson&&(e=d.toJson(h&&h[c]),"esri.tasks.FeatureSet"===d.declaredClass&&e.spatialReference&&(e.sr=e.spatialReference,delete e.spatialReference),f[c]=b?e:t.toJson(e)):f[c]=d;return f},_successHandler:function(a,b,h,g){b&&this[b].apply(this,a);h&&h.apply(null,a);g&&q._resDfd(g,
a)},_errorHandler:function(a,b,h){this.onError(a);b&&b(a);h&&h.errback(a)},setNormalization:function(a){this.normalization=a},onError:function(){}});w("extend-esri")&&(B.Task=k);return k})},"esri/tasks/FeatureSet":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../kernel ../lang ../graphic ../SpatialReference ../graphicsUtils ../geometry/Polygon ../geometry/jsonUtils ../symbols/jsonUtils".split(" "),function(k,n,t,w,B,q,m,b,a,d,h,g){k=k(null,{declaredClass:"esri.tasks.FeatureSet",
constructor:function(a,d){if(a){n.mixin(this,a);var c=this.features,f=a.spatialReference,f=this.spatialReference=h.createInstance(b.simpleConstructor,f),e=h.getGeometryType(a.geometryType);this.geometryType=a.geometryType;a.fields&&(this.fields=a.fields);var r=h.supportsLazyUnquantization(this.geometryType),l=h.unquantizeFunction(this.geometryType,this.transform),y=!!(d&&r&&l),z=e&&(y?e.accessorConstructor:e.simpleConstructor);t.forEach(c,function(a,d){var u=h.createInstance(m.simpleConstructor),
r=a.geometry;if(e&&r){var p=u.geometry=h.createInstance(z,y?null:r);p.setSpatialReference(r.spatialReference?h.createInstance(b.simpleConstructor,r.spatialReference):f);y&&p.setupLazyUnquantization(l,r)}u.symbol=a.symbol?g.fromJson(a.symbol):null;u.attributes=a.attributes;c[d]=u});y||this._hydrate()}else this.features=[]},displayFieldName:null,geometryType:null,spatialReference:null,fieldAliases:null,toJson:function(b){var d={};this.displayFieldName&&(d.displayFieldName=this.displayFieldName);this.fields&&
(d.fields=this.fields);this.spatialReference?d.spatialReference=this.spatialReference.toJson():this.features[0]&&this.features[0].geometry&&(d.spatialReference=this.features[0].geometry.spatialReference.toJson());this.features[0]&&(this.features[0].geometry&&(d.geometryType=h.getJsonType(this.features[0].geometry)),d.features=a._encodeGraphics(this.features,b));d.geometryType=d.geometryType||this.geometryType;d.exceededTransferLimit=this.exceededTransferLimit;d.transform=this.transform;return q.fixJson(d)},
_hydrate:function(){h.unquantize(this.features,this.geometryType,this.transform);this.transform=null},quantize:function(a){if(!this.geometryType)return this.transform=null,this;var b=a.translate[0],c=a.translate[1],d=a.scale[0],e=a.scale[1],g=this.features,h=function(a,b,c){var d,e,f,g,h,l,u=[];d=0;for(e=a.length;d<e;d++)if(f=a[d],0<d){if(l=b(f[0]),f=c(f[1]),l!==g||f!==h)u.push([l-g,f-h]),g=l,h=f}else g=b(f[0]),h=c(f[1]),u.push([g,h]);return 0<u.length?u:null},m=function(a,b,c){if("esriGeometryPoint"===
a)return function(a){a.x=b(a.x);a.y=c(a.y);return a};if("esriGeometryPolyline"===a||"esriGeometryPolygon"===a)return function(a){var d,f,e,g,l;e=a.rings||a.paths;l=[];d=0;for(f=e.length;d<f;d++)g=e[d],(g=h(g,b,c))&&l.push(g);return 0<l.length?(a.rings?a.rings=l:a.paths=l,a):null};if("esriGeometryMultipoint"===a)return function(a){var d;d=h(a.points,b,c);return 0<d.length?(a.points=d,a):null};if("esriGeometryEnvelope"===a)return function(a){return a}}(this.geometryType,function(a){return Math.round((a-
b)/d)},function(a){return Math.round((c-a)/e)}),z,p;z=0;for(p=g.length;z<p;z++)g[z].geometry&&(m(g[z].geometry)||g[z].setGeometry(null));this.transform=a;return this}});k.createGraphics=function(a){var d=a.geometryType,c=h.createInstance(b.simpleConstructor,a.spatialReference),e=h.getGeometryType(d).accessorConstructor,g=h.unquantizeFunction(d,a.transform);return t.map(a.features,function(a,b){var d=h.createInstance(m.simpleConstructor),f=a.geometry;if(f){var l=d.geometry=h.createInstance(e);l.setSpatialReference(c);
l.setupLazyUnquantization(g,f)}d.attributes=a.attributes;return d})};k.createPolygon=function(a,b,c){var f;a&&(f=h.createInstance(d.accessorConstructor),f.setSpatialReference(b),b=h.unquantizeFunction("esriGeometryPolygon",c),f.setupLazyUnquantization(b,a));return f};w("extend-esri")&&n.setObject("tasks.FeatureSet",k,B);return k})},"esri/tasks/RelationshipQuery":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/json","dojo/has","../kernel"],function(k,n,t,w,B){k=k(null,{declaredClass:"esri.tasks.RelationshipQuery",
definitionExpression:"",relationshipId:null,returnGeometry:!1,objectIds:null,outSpatialReference:null,outFields:null,orderByFields:null,toJson:function(){var k={definitionExpression:this.definitionExpression,relationshipId:this.relationshipId,returnGeometry:this.returnGeometry,maxAllowableOffset:this.maxAllowableOffset,geometryPrecision:this.geometryPrecision},m=this.objectIds,b=this.outFields,a=this.outSpatialReference,d=this.orderByFields;m&&(k.objectIds=m.join(","));b&&(k.outFields=b.join(","));
a&&(k.outSR=a.wkid||t.toJson(a.toJson()));d&&(k.orderByFields=d.join(","));k._ts=this._ts;return k}});w("extend-esri")&&n.setObject("tasks.RelationshipQuery",k,B);return k})},"esri/tasks/StatisticDefinition":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(k,n,t,w){k=k(null,{declaredClass:"esri.tasks.StatisticDefinition",toJson:function(){return{statisticType:this.statisticType,onStatisticField:this.onStatisticField,outStatisticFieldName:this.outStatisticFieldName,
maxPointCount:this.maxPointCount,maxRecordCount:this.maxRecordCount,maxVertexCount:this.maxVertexCount}}});t("extend-esri")&&n.setObject("tasks.StatisticDefinition",k,w);return k})},"esri/core/timerUtils":function(){define([],function(){function k(k){var m,b=k.length;for(m=0;m<b;m++)k[m]()}var n={LOW:1,HIGH:2},t,w={};w[n.LOW]=[];w[n.HIGH]=[];var B=function(){clearTimeout(t);t=null;var q=w[n.HIGH];w[n.HIGH]=[];k(q);q=w[n.LOW];w[n.LOW]=[];k(q)};return{priority:n,callbackQueue:w,setTimeout:function(k,
m){var b=[m,w[m].push(k)-1];t||(t=setTimeout(B,0));return b},clearTimeout:function(k){k&&w[k[0]].splice(k[1],1)}}})},"esri/layers/labelLayerUtils/DynamicLabelClass":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../../kernel ../../geometry/Extent ../../geometry/Polygon".split(" "),function(k,n,t,w,B,q){k=k(null,{declaredClass:"esri.layers.labelLayerUtils.DynamicLabelClass",constructor:function(){this._preparedLabels=[];this._placedLabels=[];this._extent=null;this._y1=this._x1=this._y0=
this._x0=this._ymax=this._ymin=this._xmax=this._xmin=0;this._scale=1},setMap:function(m,b){this._labelLayer=b;this._xmin=m.extent.xmin;this._xmax=m.extent.xmax;this._ymin=m.extent.ymin;this._ymax=m.extent.ymax;this._scale=(this._xmax-this._xmin)/m.width},_process:function(m){this._preparedLabels=m;this._placedLabels=[];var b;for(m=this._preparedLabels.length-1;0<=m;m--){var a=this._preparedLabels[m],d=Math.min(a.labelWidth,a.labelHeight),h=a.labelWidth+0*d,d=a.labelHeight+0*d,g=(b=a.options)&&void 0!==
b.lineLabelPlacement?b.lineLabelPlacement:"PlaceAtCenter",e=b&&void 0!==b.lineLabelPosition?b.lineLabelPosition:"Above",f=b&&void 0!==b.pointPriorities?b.pointPriorities:"AboveRight",c=[2,2,1,3,0,2,3,3,2];"AboveLeft"==f?c=[1,2,2,2,0,3,2,3,3]:"AboveCenter"==f?c=[2,1,2,2,0,2,3,3,3]:"AboveRight"==f?c=[2,2,1,3,0,2,3,3,2]:"CenterLeft"==f?c=[2,2,3,1,0,3,2,2,3]:"CenterCenter"==f?c=[0,0,0,0,1,0,0,0,0]:"CenterRight"==f?c=[3,2,2,3,0,1,3,2,2]:"BelowLeft"==f?c=[2,3,3,2,0,3,1,2,2]:"BelowCenter"==f?c=[3,3,3,2,
0,2,2,1,2]:"BelowRight"==f&&(c=[3,3,2,3,0,2,2,2,1]);var u=b&&void 0!==b.labelRotation?b.labelRotation:!0,f=Math.PI/180*a.angle;b=b&&void 0!==b.howManyLabels?b.howManyLabels:"OneLabel";if("point"==a.geometry.type)this._generatePointPositions(a,a.geometry.x,a.geometry.y,a.text,f,h,d,a.symbolWidth,a.symbolHeight,c);else if("multipoint"==a.geometry.type)for(g=a.geometry,e=0;e<g.points.length;e++)this._generatePointPositions(a,g.points[e][0],g.points[e][1],a.text,f,h,d,a.symbolWidth,a.symbolHeight,c);
else"polyline"==a.geometry.type?this._generateLinePositions(a,a.geometry,a.text,h,d,2*a.symbolHeight+d,g,e,u):"polygon"==a.geometry.type&&this._generatePolygonPositions(a,b,a.geometry,a.text,f,h,d)}return this._placedLabels},_generatePointPositions:function(m,b,a,d,h,g,e,f,c,u){f=(f+g)*this._scale;c=(c+e)*this._scale;var v,r;for(v=1;3>=v;v++)for(r=1;9>=r;r++)if(u[r-1]==v)switch(r){case 1:if(this._findPlace(m,d,b-f,a+c,h,g,e))return;break;case 2:if(this._findPlace(m,d,b,a+c,h,g,e))return;break;case 3:if(this._findPlace(m,
d,b+f,a+c,h,g,e))return;break;case 4:if(this._findPlace(m,d,b-f,a,h,g,e))return;break;case 5:if(this._findPlace(m,d,b,a,h,g,e))return;break;case 6:if(this._findPlace(m,d,b+f,a,h,g,e))return;break;case 7:if(this._findPlace(m,d,b-f,a-c,h,g,e))return;break;case 8:if(this._findPlace(m,d,b,a-c,h,g,e))return;break;case 9:if(this._findPlace(m,d,b+f,a-c,h,g,e))return}},_generateLinePositions:function(m,b,a,d,h,g,e,f,c){var u=d*this._scale*d*this._scale,v,r,l;for(v=0;v<b.paths.length;v++){var y=b.paths[v],
z=y.length,p=Math.floor((z-1)/2),k=0!==(z-1)%2?1:-1;"PlaceAtStart"==e&&(p=0,k=1);"PlaceAtEnd"==e&&(p=z-2,k=-1);for(;0<=p&&p<z-1;){for(r=p;r<z;r++){var n=y[p][0],F=y[p][1],t=y[r][0]-n,q=y[r][1]-F;if(t*t+q*q>u){for(var x=Math.atan2(q,t);x>Math.PI/2;)x-=Math.PI;for(;x<-(Math.PI/2);)x+=Math.PI;var C=Math.sin(x),G=Math.cos(x),I=0,J=0;"Above"==f&&(I=g*C*this._scale,J=g*G*this._scale);"Below"==f&&(I=-g*C*this._scale,J=-g*G*this._scale);if(1==r-p){if(this._clipLine(n,F,y[r][0],y[r][1])&&(n=this._x1-this._x0,
l=this._y1-this._y0,n*n+l*l>u&&(r=Math.atan2(l,n),t=d/2+2*h,F=t*this._scale*Math.cos(r),t=t*this._scale*Math.sin(r),"PlaceAtStart"==e?(n=this._x0+F,l=this._y0+t):"PlaceAtEnd"==e?(n=this._x1-F,l=this._y1-t):(n=this._x0+n/2,l=this._y0+l/2),this._findPlace(m,a,n-I,l+J,c?-r:0,d,h))))return}else{var K=0;for(l=p;l<=r;l++)K=Math.max(K,Math.abs((y[l][1]-F)*G-(y[l][0]-n)*C));if(K<h&&this._findPlace(m,a,n+t/2-I,F+q/2+J,c?-x:0,d,h))return}break}}p+=k}}},_generatePolygonPositions:function(m,b,a,d,h,g,e){var f;
if("ManyLabels"==b)for(b=0;b<a.rings.length;b++)f=a.rings[b],q.prototype.isClockwise(f)&&(f=this._findCentroid(f,this._xmin,this._ymin,this._xmax,this._ymax),this._findPlace(m,d,f[0],f[1],h,g,e));else{f=this._findCentroidForFeature(a,this._xmin,this._ymin,this._xmax,this._ymax);var c=f[1],u=0;for(b=0;10>b;b++){u+=e/4;f=this._findCentroidForFeature(a,this._xmin,c+(u-e/4),this._xmax,c+(u+e/4));if(this._findPlace(m,d,f[0],f[1],h,g,e))break;f=this._findCentroidForFeature(a,this._xmin,c-(u+e/4),this._xmax,
c-(u-e/4));if(this._findPlace(m,d,f[0],f[1],h,g,e))break}}},_findCentroid:function(m,b,a,d,h){var g=m.length,e=[0,0],f=0,c=m[0][0],u=m[0][1];c>d&&(c=d);c<b&&(c=b);u>h&&(u=h);u<a&&(u=a);for(var v=1;v<g-1;v++){var r=m[v][0],l=m[v][1],y=m[v+1][0],z=m[v+1][1];r>d&&(r=d);r<b&&(r=b);l>h&&(l=h);l<a&&(l=a);y>d&&(y=d);y<b&&(y=b);z>h&&(z=h);z<a&&(z=a);var p=(r-c)*(z-u)-(y-c)*(l-u);e[0]+=p*(c+r+y);e[1]+=p*(u+l+z);f+=p}e[0]/=3*f;e[1]/=3*f;if(isNaN(e[0])||isNaN(e[1]))return e;a=[];this._fillBuffer(m,a,e);e[0]=
this._sortBuffer(a,e[0],b,d);return e},_findCentroidForFeature:function(m,b,a,d,h){for(var g,e=0,f=[0,0],c=0;c<m.rings.length;c++){var u=m.rings[c],v=u.length,r=u[0][0],l=u[0][1];r>d&&(r=d);r<b&&(r=b);l>h&&(l=h);l<a&&(l=a);for(g=1;g<v-1;g++){var y=u[g][0],z=u[g][1],p=u[g+1][0],k=u[g+1][1];y>d&&(y=d);y<b&&(y=b);z>h&&(z=h);z<a&&(z=a);p>d&&(p=d);p<b&&(p=b);k>h&&(k=h);k<a&&(k=a);var n=(y-r)*(k-l)-(p-r)*(z-l);f[0]+=n*(r+y+p);f[1]+=n*(l+z+k);e+=n}}f[0]/=3*e;f[1]/=3*e;if(isNaN(f[0])||isNaN(f[1]))return f;
a=[];for(g=0;g<m.rings.length;g++)this._fillBuffer(m.rings[g],a,f);f[0]=this._sortBuffer(a,f[0],b,d);return f},_fillBuffer:function(m,b,a){for(var d=m.length-1,h=m[0][1]>=m[d][1]?1:-1,g=0;g<=d;g++){var e=g,f=g+1;g==d&&(f=0);var c=m[e][0],e=m[e][1],u=m[f][0],f=m[f][1],v=f>=e?1:-1;if(e<=a[1]&&a[1]<=f||f<=a[1]&&a[1]<=e)a[1]!=e&&a[1]!=f?(b.push((a[1]-e)*(u-c)/(f-e)+c),h=v):a[1]==e&&a[1]!=f?(h!=v&&b.push(c),h=v):a[1]!=e&&a[1]==f?(b.push(u),h=v):a[1]==e&&a[1]==f&&(1==h&&b.push(c),b.push(u),h=v)}},_sortBuffer:function(m,
b,a,d){var h=m.length;m.sort();if(0<h){for(var g=0,e=b=0;e<h-1;e+=2){var f=Math.abs(m[e+1]-m[e]);!(m[e]<=a&&m[e+1]<=a||m[e]>=d&&m[e+1]>=d)&&f>g&&(g=f,b=e)}h=m[b];m=m[b+1];h>d&&(h=d);h<a&&(h=a);m>d&&(m=d);m<a&&(m=a);b=(h+m)/2}return b},_findPlace:function(m,b,a,d,h,g,e){if(isNaN(a)||isNaN(d))return!1;for(var f=0;f<this._placedLabels.length;f++){var c=this._placedLabels[f].angle,u=this._placedLabels[f].width*this._scale,v=this._placedLabels[f].height*this._scale,r=this._placedLabels[f].x-a,l=this._placedLabels[f].y-
d;if(0===h&&0===c){if(this._findPlace2(-g*this._scale,-e*this._scale,g*this._scale,e*this._scale,r-u,l-v,r+u,l+v))return!1}else{var y=new B(-g*this._scale,-e*this._scale,g*this._scale,e*this._scale,null),z=0,p=1;0!==h&&(z=Math.sin(h),p=Math.cos(h));var k=r*p-l*z,r=r*z+l*p,c=c-h,z=Math.sin(c),p=Math.cos(c),n=-u*p- -v*z,l=-u*z+-v*p,c=+u*p- -v*z,t=+u*z+-v*p,u=k+n,v=r-l,z=k+c,p=r-t,n=k-n,l=r+l,k=k-c,r=r+t,c=new q;c.addRing([[u,v],[z,p],[n,l],[k,r],[u,v]]);if(y.intersects(c))return!1}}for(;h>Math.PI/2;)h-=
Math.PI;for(;h<-(Math.PI/2);)h+=Math.PI;f={};f.layer=m;f.text=b;f.angle=h;f.x=a;f.y=d;f.width=g;f.height=e;this._placedLabels.push(f);return!0},_findPlace2:function(m,b,a,d,h,g,e,f){return(m>=h&&m<=e||a>=h&&a<=e||m<=h&&a>=e)&&(b>=g&&b<=f||d>=g&&d<=f||b<=g&&d>=f)?!0:!1},_clipLine:function(m,b,a,d){for(var h=this._code(m,b),g=this._code(a,d);0!==h||0!==g;){if(0!==(h&g))return!1;var e=a-m,f=d-b;0!==h?(m<this._xmin?(b+=f*(this._xmin-m)/e,m=this._xmin):m>this._xmax?(b+=f*(this._xmax-m)/e,m=this._xmax):
b<this._ymin?(m+=e*(this._ymin-b)/f,b=this._ymin):b>this._ymax&&(m+=e*(this._ymax-b)/f,b=this._ymax),h=this._code(m,b)):(a<this._xmin?(d+=f*(this._xmin-a)/e,a=this._xmin):a>this._xmax?(d+=f*(this._xmax-a)/e,a=this._xmax):d<this._ymin?(a+=e*(this._ymin-d)/f,d=this._ymin):d>this._ymax&&(a+=e*(this._ymax-d)/f,d=this._ymax),g=this._code(a,d))}this._x0=m;this._y0=b;this._x1=a;this._y1=d;return!0},_code:function(m,b){var a=0;m<this._xmin&&(a+=8);m>this._xmax&&(a+=4);b<this._ymin&&(a+=2);b>this._ymax&&(a+=
1);return a}});t("extend-esri")&&n.setObject("layers.labelLayerUtils.DynamicLabelClass",k,w);return k})},"esri/layers/labelLayerUtils/StaticLabelClass":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../../kernel ../../geometry/Extent ../../geometry/Point ../../geometry/Polygon".split(" "),function(k,n,t,w,B,q,m){return k(null,{declaredClass:"esri.layers.labelLayerUtils.StaticLabel",constructor:function(){this._preparedLabels=[];this._placedLabels=[];this._extent=null;this._ymax=this._ymin=
this._xmax=this._xmin=0;this._scale=1;this._LINE_STEP_CONST=1.5;this._POLYGON_X_STEP_CONST=1;this._POLYGON_Y_STEP_CONST=.75;this._OVERRUN=2},setMap:function(b,a){this._labelLayer=a;this._map=b;this._xmin=b.extent.xmin;this._xmax=b.extent.xmax;this._ymin=b.extent.ymin;this._ymax=b.extent.ymax;this._scale=(this._xmax-this._xmin)/b.width},_process:function(b){var a,d,h,g,e,f,c,u,k;this._preparedLabels=b;this._placedLabels=[];for(b=this._preparedLabels.length-1;0<=b;b--){a=this._preparedLabels[b];e=a.labelWidth;
f=a.labelHeight;u=(c=a.options)&&c.lineLabelPlacement?c.lineLabelPlacement:"PlaceAtCenter";k=c&&c.lineLabelPosition?c.lineLabelPosition:"Above";d=c&&c.labelRotation?c.labelRotation:!0;h=Math.PI/180*a.angle;g=c&&c.howManyLabels?c.howManyLabels:"OneLabel";var r=[];if("point"===a.geometry.type)this._generatePointPositions(a.geometry.x,a.geometry.y,a.text,h,e,f,a.symbolWidth,a.symbolHeight,c,r);else if("multipoint"===a.geometry.type)for(d=0;d<a.geometry.points.length;d++)this._generatePointPositions(a.geometry.points[d][0],
a.geometry.points[d][1],a.text,h,e,f,a.symbolWidth,a.symbolHeight,c,r);else if("polyline"===a.geometry.type)if("PlaceAtStart"===u)this._generateLinePositionsPlaceAtStart(a.geometry,!0,a.text,e,f,2*a.symbolHeight+f,u,k,d,r);else if("PlaceAtEnd"===u)this._generateLinePositionsPlaceAtEnd(a.geometry,!0,a.text,e,f,2*a.symbolHeight+f,u,k,d,r);else{c=[];var l=a.geometry.getExtent(),y=this._map.extent;if(l.getWidth()<e*this._scale/this._OVERRUN&&l.getHeight()<e*this._scale/this._OVERRUN)continue;else.5*l.getWidth()<
y.getWidth()&&.5*l.getHeight()<y.getHeight()?this._generateLinePositionsPlaceAtCenter(a.geometry,!1,.1*Math.min(this._map.width,this._map.height)*this._scale,a.text,e,f,2*a.symbolHeight+f,u,k,d,c):this._generateLinePositionsPlaceAtCenter(a.geometry,!0,.2*Math.min(this._map.width,this._map.height)*this._scale,a.text,e,f,2*a.symbolHeight+f,u,k,d,c);this._postSorting(y,c,r)}else if("polygon"===a.geometry.type){u=[];for(d=0;d<a.geometry.rings.length;d++)k=a.geometry.rings[d],1<a.geometry.rings.length&&
!m.prototype.isClockwise(k)||(c=this._calcRingExtent(k),c.xmax-c.xmin<4*e*this._scale/this._OVERRUN&&c.ymax-c.ymin<4*f*this._scale/this._OVERRUN||u.push(k));u.sort(function(a,b){return b.length-a.length});for(d=0;d<u.length;d++)this._generatePolygonPositionsForManyLabels(u[d],a.geometry.spatialReference,a.text,h,e,f,r)}for(d=0;d<r.length&&(u=r[d].x,k=r[d].y,void 0!==r[d].angle&&(h=r[d].angle),c=this._findPlace(a,a.text,u,k,h,e,f),"OneLabel"!==g||!c||!this._labelLayer._isWithinScreenArea(new q(u,k,
a.geometry.spatialReference)));d++);}return this._placedLabels},_generatePointPositions:function(b,a,d,h,g,e,f,c,u,m){d=u&&u.pointPriorities?u.pointPriorities:"AboveRight";g=(f+g)*this._scale;e=(c+e)*this._scale;switch(d.toLowerCase()){case "aboveleft":b-=g;a+=e;break;case "abovecenter":a+=e;break;case "aboveright":b+=g;a+=e;break;case "centerleft":b-=g;break;case "centercenter":break;case "centerright":b+=g;break;case "belowleft":b-=g;a-=e;break;case "belowcenter":a-=e;break;case "belowright":b+=
g;a-=e;break;default:return}m.push({x:b,y:a})},_generateLinePositionsPlaceAtStart:function(b,a,d,h,g,e,f,c,u,m){f=h*this._scale;var r=this._LINE_STEP_CONST*Math.min(this._map.width,this._map.height)*this._scale,l,k,z,p,n,v,t,q;for(l=0;l<b.paths.length;l++){var A=b.paths[l],x=f,C=0;for(k=0;k<A.length-1;k++)z=A[k][0],p=A[k][1],n=A[k+1][0],v=A[k+1][1],t=n-z,q=v-p,t=Math.sqrt(t*t+q*q),C+t>x?(C=this._generatePositionsOnLine(b.spatialReference,a,x,r,C,z,p,n,v,d,h,g,e,c,u,m),x=r):C+=t}},_generateLinePositionsPlaceAtEnd:function(b,
a,d,h,g,e,f,c,u,m){f=h*this._scale;var r=this._LINE_STEP_CONST*Math.min(this._map.width,this._map.height)*this._scale,l,k,n,p,v,t,q,w;for(l=0;l<b.paths.length;l++){var A=b.paths[l],x=f,C=0;for(k=A.length-2;0<=k;k--)n=A[k+1][0],p=A[k+1][1],v=A[k][0],t=A[k][1],q=v-n,w=t-p,q=Math.sqrt(q*q+w*w),C+q>x?(C=this._generatePositionsOnLine(b.spatialReference,a,x,r,C,n,p,v,t,d,h,g,e,c,u,m),x=r):C+=q}},_generateLinePositionsPlaceAtCenter:function(b,a,d,h,g,e,f,c,u,m,r){var l,k,n,p,v,t,q,w;for(c=0;c<b.paths.length;c++){var A=
b.paths[c];if(!(2>A.length)){if(2==A.length){p=A[0];l=A[1];n=p[0];p=p[1];A=l[0];t=l[1];v=(A-n)*(A-n)+(t-p)*(t-p);q=Math.atan2(t-p,A-n);t=Math.cos(q);q=Math.sin(q);A=[];w=n;for(var x=p;(w-n)*(w-n)+(x-p)*(x-p)<v;)A.push([w,x]),w+=d/2*t,x+=d/2*q;A.push(l)}var C=0;for(l=0;l<A.length-1;l++)n=A[l][0],p=A[l][1],v=A[l+1][0],t=A[l+1][1],q=v-n,w=t-p,C+=Math.sqrt(q*q+w*w);for(l=x=0;l<A.length-1;l++){n=A[l][0];p=A[l][1];v=A[l+1][0];t=A[l+1][1];q=v-n;w=t-p;q=Math.sqrt(q*q+w*w);if(x+q>C/2)break;x+=q}l==A.length-
1&&l--;n=A[l][0];p=A[l][1];v=A[l+1][0];t=A[l+1][1];q=v-n;w=t-p;x=C/2-x;q=Math.atan2(w,q);w=n+x*Math.cos(q);q=p+x*Math.sin(q);n=this._angleAndShifts(n,p,v,t,f,u,m);r.push({x:w+n.shiftX,y:q+n.shiftY,angle:n.angle});var C=w,G=q,x=0;for(k=l;k<A.length-1;k++)k==l?(n=C,p=G):(n=A[k][0],p=A[k][1]),v=A[k+1][0],t=A[k+1][1],q=v-n,w=t-p,q=Math.sqrt(q*q+w*w),x=x+q>d?this._generatePositionsOnLine(b.spatialReference,a,d,d,x,n,p,v,t,h,g,e,f,u,m,r):x+q;x=0;for(k=l;0<=k;k--)k==l?(n=C,p=G):(n=A[k+1][0],p=A[k+1][1]),
v=A[k][0],t=A[k][1],q=v-n,w=t-p,q=Math.sqrt(q*q+w*w),x=x+q>d?this._generatePositionsOnLine(b.spatialReference,a,d,d,x,n,p,v,t,h,g,e,f,u,m,r):x+q}}},_generatePositionsOnLine:function(b,a,d,h,g,e,f,c,u,k,m,l,n,q,p,t){k=Math.atan2(u-f,c-e);m=e;l=f;var r=m,v=l;do if(g=d-g,m+=g*Math.cos(k),l+=g*Math.sin(k),this._belongs(m,l,e,f,c,u))g=this._angleAndShifts(e,f,c,u,n,q,p),d=m+g.shiftX,v=l+g.shiftY,a?this._labelLayer._isWithinScreenArea(new B(d,v,d,v,b))&&t.push({x:d,y:v,angle:g.angle}):t.push({x:d,y:v,angle:g.angle}),
r=m,v=l,g=0,d=h;else return b=c-r,u-=v,Math.sqrt(b*b+u*u);while(1)},_postSorting:function(b,a,d){if(b&&0<a.length){var h=.5*(b.xmin+b.xmax);b=.5*(b.ymin+b.ymax);for(var g=a[0].x,e=a[0].y,f=Math.sqrt((g-h)*(g-h)+(e-b)*(e-b)),c=a[0].angle,u=0;u<a.length;u++){var k=a[u].x,m=a[u].y,l=Math.sqrt((k-h)*(k-h)+(m-b)*(m-b));l<f&&(g=k,e=m,f=l,c=a[u].angle)}d.push({x:g,y:e,angle:c})}},_belongs:function(b,a,d,h,g,e){if(g==d&&e==h)return!1;if(g>d){if(b>g||b<d)return!1}else if(b<g||b>d)return!1;if(e>h){if(a>e||
a<h)return!1}else if(a<e||a>h)return!1;return!0},_angleAndShifts:function(b,a,d,h,g,e,f){for(b=Math.atan2(h-a,d-b);b>Math.PI/2;)b-=Math.PI;for(;b<-(Math.PI/2);)b+=Math.PI;h=Math.sin(b);var c=Math.cos(b);d=a=0;"Above"==e&&(a=g*h*this._scale,d=g*c*this._scale);"Below"==e&&(a=-g*h*this._scale,d=-g*c*this._scale);g=[];g.angle=f?-b:0;g.shiftX=-a;g.shiftY=d;return g},_generatePolygonPositionsForManyLabels:function(b,a,d,h,g,e,f){g=this._findCentroidForRing(b);h=g[0];var c=g[1],k=this._calcRingExtent(b);
g=k.xmin;e=k.ymin;var m=k.xmax,k=k.ymax,r=(k-e)/(this._map.height*this._scale);if(!(10<(m-g)/(this._map.width*this._scale)&&10<r)){var l=!0;if(m-g>this._map.width*this._scale||k-e>this._map.height*this._scale)l=!1;var r=this._map.width*this._scale*(l?.1875:.5),l=this._map.height*this._scale*(l?.1875:.5),n=!0,q=!0,p=0;do{c+=(p%2?-1:1)*p*l;if(this._scanRingByX(d,a,b,h,c,g,m,r,f))break;c<e&&(n=!1);c>k&&(q=!1);p++}while(n||q)}},_scanRingByX:function(b,a,d,h,g,e,f,c,k){var m=!0,u=!0,l=0,n=1E3;do{h+=(l%
2?-1:1)*l*c;var q=this._movePointInsideRing(d,h,g),p=this._labelLayer._isWithinScreenArea(new B(q,g,q,g,a)),t=this._isPointWithinRing(b,d,q,g);if(p&&t)return k.push({x:q,y:g}),!0;h<e&&(m=!1);h>f&&(u=!1);l++;n--;if(0>=n)return!0}while(m||u);return!1},_movePointInsideRing:function(b,a,d){for(var h=[],g=b.length-1,e=b[0][1]>=b[g][1]?1:-1,f=0;f<=g;f++){var c=f,k=f+1;f==g&&(k=0);var m=b[c][0],c=b[c][1],n=b[k][0],k=b[k][1],l=k>=c?1:-1;if(c<=d&&d<=k||k<=d&&d<=c)d!=c&&d!=k?(h.push((d-c)*(n-m)/(k-c)+m),e=
l):d==c&&d!=k?(e!=l&&h.push(m),e=l):d!=c&&d==k?(h.push(n),e=l):d==c&&d==k&&(1==e&&h.push(m),h.push(n),e=l)}h.sort(function(a,b){return a-b});b=h.length;if(0<b){for(f=d=a=0;f<b-1;f+=2)g=Math.abs(h[f+1]-h[f]),g>a&&(a=g,d=f);a=(h[d]+h[d+1])/2}return a},_calcRingExtent:function(b){var a,d;d=new B;for(a=0;a<b.length-1;a++){var h=b[a][0],g=b[a][1];if(void 0===d.xmin||h<d.xmin)d.xmin=h;if(void 0===d.ymin||g<d.ymin)d.ymin=g;if(void 0===d.xmax||h>d.xmax)d.xmax=h;if(void 0===d.ymax||g>d.ymax)d.ymax=g}return d},
_isPointWithinPolygon:function(b,a,d,h){var g;for(g=0;g<a.rings.length;g++)if(this._isPointWithinRing(b,a.rings[g],d,h))return!0;return!1},_isPointWithinRing:function(b,a,d,h){var g,e,f,c,k=[],m=a.length;for(b=0;b<m-1;b++)if(g=a[b][0],e=a[b][1],f=a[b+1][0],c=a[b+1][1],g!=f||e!=c){if(e==c)if(h==e)k.push(g);else continue;g==f?(e<c&&h>=e&&h<c&&k.push(g),e>c&&h<=e&&h>c&&k.push(g)):(e=(f-g)/(c-e)*(h-e)+g,g<f&&e>=g&&e<f&&k.push(e),g>f&&e<=g&&e>f&&k.push(e))}k.sort(function(a,b){return a-b});for(b=0;b<k.length-
1;b++)if(g=k[b],f=k[b+1],d>=g&&d<f)if(b%2)break;else return!0;return!1},_findCentroidForRing:function(b){for(var a=b.length,d=[0,0],h=0,g=b[0][0],e=b[0][1],f=1;f<a-1;f++){var c=b[f][0],k=b[f][1],m=b[f+1][0],n=b[f+1][1],l=(c-g)*(n-e)-(m-g)*(k-e);d[0]+=l*(g+c+m);d[1]+=l*(e+k+n);h+=l}d[0]/=3*h;d[1]/=3*h;return d},_findCentroidForFeature:function(b){for(var a=0,d=[0,0],h=0;h<b.rings.length;h++)for(var g=b.rings[h],e=g.length,f=g[0][0],c=g[0][1],k=1;k<e-1;k++){var m=g[k][0],n=g[k][1],l=g[k+1][0],q=g[k+
1][1],t=(m-f)*(q-c)-(l-f)*(n-c);d[0]+=t*(f+m+l);d[1]+=t*(c+n+q);a+=t}d[0]/=3*a;d[1]/=3*a;return d},_findPlace:function(b,a,d,h,g,e,f){if(isNaN(d)||isNaN(h))return!1;for(var c=0;c<this._placedLabels.length;c++){var k=this._placedLabels[c].angle,n=this._placedLabels[c].width*this._scale,r=this._placedLabels[c].height*this._scale,l=this._placedLabels[c].x-d,q=this._placedLabels[c].y-h;if(0===g&&0===k){if(this._findPlace2(-e*this._scale,-f*this._scale,e*this._scale,f*this._scale,l-n,q-r,l+n,q+r))return!1}else{var t=
new B(-e*this._scale,-f*this._scale,e*this._scale,f*this._scale,null),p=0,w=1;0!==g&&(p=Math.sin(g),w=Math.cos(g));var D=l*w-q*p,l=l*p+q*w,k=k-g,p=Math.sin(k),w=Math.cos(k),F=-n*w- -r*p,q=-n*p+-r*w,k=+n*w- -r*p,H=+n*p+-r*w,n=D+F,r=l-q,p=D+k,w=l-H,F=D-F,q=l+q,D=D-k,l=l+H,k=new m;k.addRing([[n,r],[p,w],[F,q],[D,l],[n,r]]);if(t.intersects(k))return!1}}for(;g>Math.PI/2;)g-=Math.PI;for(;g<-(Math.PI/2);)g+=Math.PI;c={};c.layer=b;c.text=a;c.angle=g;c.x=d;c.y=h;c.width=e;c.height=f;this._placedLabels.push(c);
return!0},_findPlace2:function(b,a,d,h,g,e,f,c){return(b>=g&&b<=f||d>=g&&d<=f||b<=g&&d>=f)&&(a>=e&&a<=c||h>=e&&h<=c||a<=e&&h>=c)?!0:!1}})})},"*noref":1}});
define("esri/layers/LabelLayer","require dojo/_base/declare dojo/_base/lang dojo/number dojo/i18n!dojo/cldr/nls/number dojo/_base/array dojo/_base/connect dojo/has dojox/gfx/_base ../kernel ../lang ../graphic ../PopupInfo ../core/timerUtils ./labelLayerUtils/DynamicLabelClass ./labelLayerUtils/StaticLabelClass ./support/attributeUtils ../symbols/TextSymbol ../symbols/ShieldLabelSymbol ../geometry/Extent ../geometry/Point ../geometry/webMercatorUtils ./GraphicsLayer ./LabelClass ../renderers/SimpleRenderer ../support/expressionUtils".split(" "),function(k,
n,t,w,B,q,m,b,a,d,h,g,e,f,c,u,v,r,l,y,z,p,E,D,F,H){function A(a){return"sizeInfo"===a.type}k=n(E,{declaredClass:"esri.layers.LabelLayer",constructor:function(a){this._refreshLabels=t.hitch(this,this._refreshLabels);this.id="labels";this.featureLayers=[];this._featureLayerInfos=[];this._preparedLabels=[];this._engineType="STATIC";this._mapEventHandlers=[];a&&(a.id&&(this.id=a.id),a.mode&&(this._engineType="DYNAMIC"===a.mode.toUpperCase()?"DYNAMIC":"STATIC"))},_setMap:function(a){this._mapEventHandlers.push(a.on("extent-change",
t.hitch(this,"_handleLevelChange")));var b=this.inherited(arguments);this.refresh();return b},_unsetMap:function(){var a;for(a=0;a<this._mapEventHandlers.length;a++)m.disconnect(this._mapEventHandlers[a]);this.refresh();f.clearTimeout(this._refreshHandle);this._refreshHandle=null;this.inherited(arguments)},setAlgorithmType:function(a){this._engineType=a&&"DYNAMIC"===a.toUpperCase()?"DYNAMIC":"STATIC";this.refresh()},addFeatureLayer:function(a,b,c,d){if(!this.getFeatureLayer(a.layerId)){var f=[];f.push(a.on("update-end",
t.hitch(this,"refresh")));f.push(a.on("suspend",t.hitch(this,"refresh")));f.push(a.on("resume",t.hitch(this,"refresh")));f.push(a.on("edits-complete",t.hitch(this,"refresh")));f.push(a.on("labeling-info-change",t.hitch(this,"refresh")));f.push(a.on("time-extent-change",t.hitch(this,"refresh")));f.push(a.on("show-labels-change",t.hitch(this,"refresh")));f.push(a.on("feature-reduction-change",t.hitch(this,"refresh")));this._featureLayerInfos.push({FeatureLayer:a,LabelExpressionInfo:c,LabelingOptions:d,
LabelRenderer:b,EventHandlers:f});this.featureLayers.push(a);this.refresh()}},getFeatureLayer:function(a){var b,c;for(b=0;b<this.featureLayers.length;b++)if(c=this.featureLayers[b],void 0!==c&&c.id==a)return c;return null},removeFeatureLayer:function(a){var b;a=this.getFeatureLayer(a);if(void 0!==a&&(b=q.indexOf(this.featureLayers,a),-1<b)){this.featureLayers.splice(b,1);for(a=0;a<this._featureLayerInfos[b].EventHandlers.length;a++)m.disconnect(this._featureLayerInfos[b].EventHandlers[a]);this._featureLayerInfos.splice(b,
1);this.refresh()}},removeAllFeatureLayers:function(){var a;for(a=0;a<this.featureLayers.length;a++){for(var b=0;b<this._featureLayerInfos[a].EventHandlers.length;b++)m.disconnect(this._featureLayerInfos[a].EventHandlers[b]);this.featureLayers=[];this._featureLayerInfos=[]}this.refresh()},getFeatureLayers:function(){return this.featureLayers},getFeatureLayerInfo:function(a){var b,c;for(b=0;b<this.featureLayers.length;b++)if(c=this.featureLayers[b],void 0!==c&&c.id==a)return this._featureLayerInfos[b];
return null},refresh:function(){null==this._refreshHandle&&(this._refreshHandle=f.setTimeout(this._refreshLabels,f.priority.LOW))},_handleLevelChange:function(a){a.levelChange&&this.clear();this.refresh()},_refreshLabels:function(a){this._refreshHandle=null;var b,d,f,e,g,h=[],k,l="DYNAMIC"===this._engineType?new c:new u;if(this._map){l.setMap(this._map,this);this._preparedLabels=[];for(a=0;a<this.featureLayers.length;a++)if(d=this.featureLayers[a],d.visible&&d.showLabels&&d.visibleAtMapScale&&!d._suspended)if(b=
this._featureLayerInfos[a],g=this._convertOptions(null),b.LabelRenderer){if(h=d.labelingInfo)if(k=h[0])e=this._getLabelExpression(k),g=this._convertOptions(k);f=b.LabelRenderer;b.LabelExpressionInfo&&(e=b.LabelExpressionInfo);b.LabelingOptions&&(g=this._convertOptions(null),void 0!==b.LabelingOptions.pointPriorities&&(h=b.LabelingOptions.pointPriorities,g.pointPriorities="above-center"==h||"AboveCenter"==h||"esriServerPointLabelPlacementAboveCenter"==h?"AboveCenter":"above-left"==h||"AboveLeft"==
h||"esriServerPointLabelPlacementAboveLeft"==h?"AboveLeft":"above-right"==h||"AboveRight"==h||"esriServerPointLabelPlacementAboveRight"==h?"AboveRight":"below-center"==h||"BelowCenter"==h||"esriServerPointLabelPlacementBelowCenter"==h?"BelowCenter":"below-left"==h||"BelowLeft"==h||"esriServerPointLabelPlacementBelowLeft"==h?"BelowLeft":"below-right"==h||"BelowRight"==h||"esriServerPointLabelPlacementBelowRight"==h?"BelowRight":"center-center"==h||"CenterCenter"==h||"esriServerPointLabelPlacementCenterCenter"==
h?"CenterCenter":"center-left"==h||"CenterLeft"==h||"esriServerPointLabelPlacementCenterLeft"==h?"CenterLeft":"center-right"==h||"CenterRight"==h||"esriServerPointLabelPlacementCenterRight"==h?"CenterRight":"AboveRight"),void 0!==b.LabelingOptions.lineLabelPlacement&&(g.lineLabelPlacement=b.LabelingOptions.lineLabelPlacement),void 0!==b.LabelingOptions.lineLabelPosition&&(g.lineLabelPosition=b.LabelingOptions.lineLabelPosition),void 0!==b.LabelingOptions.labelRotation&&(g.labelRotation=b.LabelingOptions.labelRotation),
void 0!==b.LabelingOptions.howManyLabels&&(g.howManyLabels=b.LabelingOptions.howManyLabels));f instanceof D&&(e=this._getLabelExpression(f),f=new F(f.symbol),g=this._convertOptions(f));this._addLabels(d,f,e,g)}else if(h=d.labelingInfo)for(b=h.length-1;0<=b;b--)if(k=h[b])f=new D(k instanceof D?k.toJson():k),e=this._getLabelExpression(k),g=this._convertOptions(k),this._addLabels(d,f,e,g);e=l._process(this._preparedLabels);this.clear();this.drawLabels(this._map,e)}},drawLabels:function(a,b){this._scale=
(a.extent.xmax-a.extent.xmin)/a.width;var c;for(c=0;c<b.length;c++){var d=b[c],f=d.x,e=d.y,h=d.text,k=d.angle,l=d.layer.labelSymbol;"polyline"==d.layer.geometry.type&&d.layer.options.labelRotation&&l.setAngle(180/Math.PI*k);l.setText(h);d=f;l instanceof r&&(f=l.getHeight(),d-=.25*f*this._scale*Math.sin(k),e-=.33*f*this._scale);k=new g(new z(d,e,a.extent.spatialReference));k.setSymbol(l);this.add(k)}},_addLabels:function(a,b,c,d){var f,e,g,h;if(this._isWithinScaleRange(b.minScale,b.maxScale)&&c&&""!==
c){var k=this._map,l=!a.url&&!k.spatialReference.equals(a.spatialReference);for(f=0;f<a.graphics.length;f++)if(e=a.graphics[f],!1!==e.visible&&!e._suspended){g=e.geometry;if(l){if(!p.canProject(g,k))continue;g=p.project(g,k)}g&&this._isWhere(b.where,e.attributes)&&this._isWithinScreenArea(g)&&(h=this._buildLabelText(c,e,a.fields,d),this._addLabel(h,b,a.renderer,e,d,g,k))}}},_isWithinScreenArea:function(a){a="point"===a.type?new y(a.x,a.y,a.x,a.y,a.spatialReference):a.getExtent();if(void 0===a)return!1;
a=this._intersects(this._map,a);return null===a||0===a.length?!1:!0},_isWithinScaleRange:function(a,b){var c=this._map.getScale();return 0<a&&c>=a||0<b&&c<=b?!1:!0},_isWhere:function(a,b){try{if(!a)return!0;if(a){var c=a.split(" ");if(3===c.length)return this._sqlEquation(b[this._removeQuotes(c[0])],c[1],this._removeQuotes(c[2]));if(7===c.length){var d=this._sqlEquation(b[this._removeQuotes(c[0])],c[1],this._removeQuotes(c[2])),f=c[3],e=this._sqlEquation(b[this._removeQuotes(c[4])],c[5],this._removeQuotes(c[6]));
switch(f){case "AND":return d&&e;case "OR":return d||e}}}return!1}catch(L){console.log("Error.: can't parse \x3d "+a)}},_sqlEquation:function(a,b,c){switch(b){case "\x3d":return a==c?!0:!1;case "\x3c\x3e":return a!=c?!0:!1;case "\x3e":return a>c?!0:!1;case "\x3e\x3d":return a>=c?!0:!1;case "\x3c":return a<c?!0:!1;case "\x3c\x3d":return a<=c?!0:!1}return!1},_removeQuotes:function(a){var b=a.indexOf('"'),c=a.lastIndexOf('"');if(-1!=b&&-1!=c)return a.substr(1,a.length-2);b=a.indexOf("'");c=a.lastIndexOf("'");
return-1!=b&&-1!=c?a.substr(1,a.length-2):a},_getSizeInfo:function(a){return a?a.sizeInfo||q.filter(a.visualVariables,A)[0]:null},_addLabel:function(b,c,d,f,e,g,h){var k,m,n,p;if(b&&""!==t.trim(b)&&c){b=b.replace(/\s+/g," ");k=c.getSymbol(f);k instanceof r?(k=new r(k.toJson()),k.setVerticalAlignment("baseline"),k.setHorizontalAlignment("center")):k=k instanceof l?new l(k.toJson()):new r;k.setText(b);c.symbol=k;if(n=this._getProportionalSize(c.sizeInfo,f.attributes))k instanceof r?k.setSize(n):k instanceof
l&&(k.setWidth(n),k.setHeight(n));p=n=0;if(d){m=d.getSymbol(f);var q=this._getSizeInfo(d);if((d=q?d.getSize(f,{sizeInfo:q,resolution:h.getResolutionInMeters()}):f.size)&&null!==d)n=p=d;else if(m)if("simplemarkersymbol"==m.type)p=n=m.size;else if("picturemarkersymbol"==m.type)n=m.width,p=m.height;else if("simplelinesymbol"==m.type||"cartographiclinesymbol"==m.type)n=m.width}d={};d.graphic=f;d.options=e;d.geometry=g;d.labelRenderer=c;d.labelSymbol=k;d.labelWidth=k.getWidth()/2;d.labelHeight=k.getHeight()/
2;d.symbolWidth=a.normalizedLength(n)/2;d.symbolHeight=a.normalizedLength(p)/2;d.text=b;d.angle=k.angle;this._preparedLabels.push(d)}},_buildLabelText:function(a,b,c,d){if(d.hasExpression)return a=d.arcadeCache,b=b._getDataValue(a.attributeInfo,a,H),h.isDefined(b)?""+b:"";var f=b.attributes;return a.replace(/{[^}]*}/g,function(a){var b,g=a;for(b=0;b<c.length;b++)if("{"+c[b].name+"}"==a){var g=f[c[b].name],k=c[b].domain;if(k&&t.isObject(k)){if("codedValue"==k.type&&d.useCodedValues)for(b=g,a=0;a<k.codedValues.length;a++){if(k.codedValues[a].code==
b){g=k.codedValues[a].name;break}}else"range"==k.type&&k.minValue<=g&&g<=k.maxValue&&(g=k.name);break}k=c[b].type;if(d.fieldInfos){var l=d.fieldInfos;for(b=0;b<l.length;b++)if("{"+l[b].fieldName+"}"==a){a=l[b].format;"esriFieldTypeDate"==k?(a="DateFormat"+e.prototype._dateFormats[a.dateFormat?a.dateFormat:"shortDate"])&&(g=h.substitute({myKey:g},"${myKey:"+a+"}")):"esriFieldTypeInteger"!=k&&"esriFieldTypeSingle"!=k&&"esriFieldTypeSmallInteger"!=k&&"esriFieldTypeLong"!=k&&"esriFieldTypeDouble"!=k||
!a||(g=w.format(g,{places:a.places}),a.digitSeparator||B.group&&(g=g.replace(new RegExp("\\"+B.group,"g"),"")));break}}break}else g="";return null==g?"":g})},_getLabelExpression:function(a){var b="";a.labelExpressionInfo?b=a.labelExpressionInfo.value||a.labelExpressionInfo.expression:this._validSyntax(a.labelExpression)&&(b=this._convertLabelExpression(a.labelExpression));return b},_validSyntax:function(a){return/^(\s*\[[^\]]+\]\s*)+$/i.test(a)},_convertLabelExpression:function(a){return a.replace(RegExp("\\[",
"g"),"{").replace(RegExp("\\]","g"),"}")},_getProportionalSize:function(a,b){if(!a)return null;var c=h.substitute(b,"${"+a.field+"}",{first:!0});return!(a.minSize&&a.maxSize&&a.minDataValue&&a.maxDataValue&&c)||0>=a.maxDataValue-a.minDataValue?null:(a.maxSize-a.minSize)/(a.maxDataValue-a.minDataValue)*(c-a.minDataValue)+a.minSize},_convertOptions:function(a){var b=!0,c="shortDate",d=null,f=null,e="",g=!0,h,k;if(a&&(a.format&&(c=a.format.dateFormat,d={places:a.format.places,digitSeparator:a.format.digitSeparator}),
f=a.fieldInfos,e=a.labelPlacement,null!=a.useCodedValues&&(b=a.useCodedValues),a=a.labelExpressionInfo)){var l=a.expression;l&&!a.value&&(k=!0,h=v.createAttributeCache({valueExpression:l},!0))}if("always-horizontal"==e||"esriServerPolygonPlacementAlwaysHorizontal"==e)g=!1;return{useCodedValues:b,dateFormat:c,numberFormat:d,fieldInfos:f,pointPriorities:"above-center"==e||"esriServerPointLabelPlacementAboveCenter"==e?"AboveCenter":"above-left"==e||"esriServerPointLabelPlacementAboveLeft"==e?"AboveLeft":
"above-right"==e||"esriServerPointLabelPlacementAboveRight"==e?"AboveRight":"below-center"==e||"esriServerPointLabelPlacementBelowCenter"==e?"BelowCenter":"below-left"==e||"esriServerPointLabelPlacementBelowLeft"==e?"BelowLeft":"below-right"==e||"esriServerPointLabelPlacementBelowRight"==e?"BelowRight":"center-center"==e||"esriServerPointLabelPlacementCenterCenter"==e?"CenterCenter":"center-left"==e||"esriServerPointLabelPlacementCenterLeft"==e?"CenterLeft":"center-right"==e||"esriServerPointLabelPlacementCenterRight"==
e?"CenterRight":"AboveRight",lineLabelPlacement:"above-start"==e||"below-start"==e||"center-start"==e?"PlaceAtStart":"above-end"==e||"below-end"==e||"center-end"==e?"PlaceAtEnd":"PlaceAtCenter",lineLabelPosition:"above-after"==e||"esriServerLinePlacementAboveAfter"==e||"above-along"==e||"esriServerLinePlacementAboveAlong"==e||"above-before"==e||"esriServerLinePlacementAboveBefore"==e||"above-start"==e||"esriServerLinePlacementAboveStart"==e||"above-end"==e||"esriServerLinePlacementAboveEnd"==e?"Above":
"below-after"==e||"esriServerLinePlacementBelowAfter"==e||"below-along"==e||"esriServerLinePlacementBelowAlong"==e||"below-before"==e||"esriServerLinePlacementBelowBefore"==e||"below-start"==e||"esriServerLinePlacementBelowStart"==e||"below-end"==e||"esriServerLinePlacementBelowEnd"==e?"Below":"center-after"==e||"esriServerLinePlacementCenterAfter"==e||"center-along"==e||"esriServerLinePlacementCenterAlong"==e||"center-before"==e||"esriServerLinePlacementCenterBefore"==e||"center-start"==e||"esriServerLinePlacementCenterStart"==
e||"center-end"==e||"esriServerLinePlacementCenterEnd"==e?"OnLine":"Above",labelRotation:g,howManyLabels:"OneLabel",hasExpression:k,arcadeCache:h}}});b("extend-esri")&&t.setObject("layers.LabelLayer",k,d);return k});